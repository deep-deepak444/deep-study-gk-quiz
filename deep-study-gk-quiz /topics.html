<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Topics</title>
  <link rel="stylesheet" href="style.css">
  <style>
  	body {
 	   background-color: #e0f7fa; /* ‡§π‡§≤‡•ç‡§ï‡§æ ‡§Ü‡§∏‡§Æ‡§æ‡§®‡•Ä ‡§∞‡§Ç‡§ó */
    	background-image: linear-gradient(135deg, #e0f7fa 0%, #c8e6c9 100%); /* ‡§Ü‡§∏‡§Æ‡§æ‡§®‡•Ä ‡§∏‡•á ‡§π‡§≤‡•ç‡§ï‡•á ‡§π‡§∞‡•á ‡§∞‡§Ç‡§ó ‡§ï‡§æ ‡§ó‡•ç‡§∞‡•á‡§°‡§ø‡§è‡§Ç‡§ü */
  	}
	</style>

</head>
<body>
  <div class="header-bar">
    <button class="back-btn" onclick="goBack()">‚¨Ö Back</button>
    <span id="subject-title">üìö Topics</span>
  </div>
  
  <div class="topics-container" id="topics-list">
    <div class="loader"></div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const subject = urlParams.get("subject") || "history";
    document.getElementById("subject-title").textContent = "üìö " + subject.toUpperCase().replace(/_/g, ' ');

	async function loadTopics() {
 	  const list = document.getElementById("topics-list");
	  try {
   	    const versionResponse = await fetch('version.json');
   	    const serverVersionData = await versionResponse.json();
  	    const serverVersion = serverVersionData.topicsVersion;

	    // ‡§™‡§π‡§≤‡•á ‡§≤‡•ã‡§ï‡§≤ ‡§∏‡•ç‡§ü‡•ã‡§∞‡•á‡§ú ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§ï‡•ã ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
	    const localVersion = localStorage.getItem('topicsVersion');
	    const cachedData = localStorage.getItem('topicsData');

 	    // ‡§Ö‡§¨ ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç ‡§ï‡§ø ‡§°‡•á‡§ü‡§æ ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à ‡§î‡§∞ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§∏‡§π‡•Ä ‡§π‡•à
 	    if (localVersion === serverVersion && cachedData) {
     	  console.log("Loading topics from cache (localStorage).");
     	  // ‡§ï‡•á‡§µ‡§≤ ‡§§‡§≠‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∏ ‡§ï‡§∞‡•á‡§Ç ‡§ú‡§¨ ‡§°‡•á‡§ü‡§æ ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•ã
  	      const topicsData = JSON.parse(cachedData);
  	      displayTopics(topicsData);
	    } else {
  	      console.log("Fetching new topics from server.");
   	      const topicsResponse = await fetch('subjects/topics.json');
   	      const topicsData = await topicsResponse.json();
      
   	      localStorage.setItem('topicsData', JSON.stringify(topicsData));
  	      localStorage.setItem('topicsVersion', serverVersion);
      
   	      displayTopics(topicsData);
   	    }
	  } catch (err) {
	    console.error(err);
	    list.innerHTML = "<p>‡§ü‡•â‡§™‡§ø‡§ï‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤‡•§</p>";
	  }
	}

	function displayTopics(allTopicsData) {
  	  const urlParams = new URLSearchParams(window.location.search);
  	  const subject = urlParams.get("subject");
  	  const topicsForSubject = allTopicsData[subject];
  	  const list = document.getElementById("topics-list");
   	  list.innerHTML = "";

  	  if (topicsForSubject && topicsForSubject.length > 0) {
   	    topicsForSubject.forEach(topic => {
        	const card = document.createElement("div");
       	    card.className = "topic-card";
        	card.textContent = topic.name;
         	card.onclick = () => {
            	window.location.href = `quiz.html?subject=${subject}&topic=${topic.file}`;
        	};
        	list.appendChild(card);
     	  });
  	  } else {
	      list.innerHTML = "<p>‡§á‡§∏ ‡§µ‡§ø‡§∑‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§ü‡•â‡§™‡§ø‡§ï ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>";
	    }
	}

	loadTopics();
	
	function goBack() {
	  window.location.href = 'subjects.html';
	}
  </script>
</body>
</html>
